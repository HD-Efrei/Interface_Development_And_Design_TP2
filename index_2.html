<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="utf-8">
    <script src="https://aframe.io/releases/1.7.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js@3.4.5/aframe/build/aframe-ar.min.js"></script>

    <script>
        AFRAME.registerComponent('spin', {
            schema: {
                speed: {
                    default: 180
                }
            }, // degrés/s
            tick: function(time, dt) {
                if (!this.el.object3D.visible) return; // évite quand le marqueur est perdu
                const rot = this.el.getAttribute('rotation');
                rot.y = (rot.y + this.data.speed * (dt / 1000)) % 360;
                this.el.setAttribute('rotation', rot);
            }
        });

        AFRAME.registerComponent('speed-on-click', {
            schema: {
                normal: {
                    default: 2000
                },
                fast: {
                    default: 400
                }
            }, // ms par tour
            init() {
                this.isFast = false; // départ lent
                this.el.addEventListener('click', () => {
                    this.isFast = !this.isFast;
                    const durMs = this.isFast ? this.data.fast : this.data.normal;
                    const degPerSec = 360000 / durMs; // 360° / (dur ms)
                    this.el.setAttribute('spin', 'speed', degPerSec);
                });
            }
        });

        AFRAME.registerComponent('color-random-hex-on-click', {
            init() {
                this.el.addEventListener('click', () => {
                    const hex = '#' + Math.floor(Math.random() * 0xFFFFFF).toString(16).padStart(6, '0');
                    this.el.setAttribute('material', 'color', hex);
                });
            }
        });
    </script>
</head>

<body>
    <a-scene arjs="sourceType: webcam; debugUIEnabled: false;">
        <a-marker preset="hiro">
            <a-box class="clickable" material="color: blue; opacity: 0.5; transparent: true" position="0 1 0 " spin="speed: 180 " speed-on-click=" normal:2000; fast:400 " color-random-hex-on-click></a-box>
        </a-marker>
        <a-entity camera cursor="rayOrigin: mouse " raycaster="objects: .clickable ">
        </a-entity>
    </a-scene>
</body>

</html>