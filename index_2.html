<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover" />

    <title>TP2 : Ex 3</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://aframe.io/releases/1.7.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js@3.4.5/aframe/build/aframe-ar.min.js"></script>

    <script>
        AFRAME.registerComponent('spin', {
            schema: {
                speed: {
                    default: 180
                }
            },
            tick: function(time, dt) {
                if (!this.el.object3D.visible) return;
                const rot = this.el.getAttribute('rotation');
                rot.y = (rot.y + this.data.speed * (dt / 1000)) % 360;
                this.el.setAttribute('rotation', rot);
            }
        });

        AFRAME.registerComponent('speed-on-click', {
            schema: {
                normal: {
                    default: 2000
                },
                fast: {
                    default: 400
                }
            },
            init() {
                this.isFast = false;
                this.el.addEventListener('click', () => {
                    this.isFast = !this.isFast;
                    const durMs = this.isFast ? this.data.fast : this.data.normal;
                    const degPerSec = 360000 / durMs;
                    this.el.setAttribute('spin', 'speed', degPerSec);
                });
            }
        });

        AFRAME.registerComponent('color-random-hex-on-click', {
            init() {
                this.el.addEventListener('click', () => {
                    const hex = '#' + Math.floor(Math.random() * 0xFFFFFF).toString(16).padStart(6, '0');
                    this.el.setAttribute('material', 'color', hex);
                });
            }
        });
    </script>
</head>

<body>

    <nav class="overlay">
        <a class="btn" href="index.html">Accueil</a>
        <a class="btn" href="index_2.html">AR Hiro</a>
        <a class="btn" href="index_3.html">Marker perso</a>
        <a class="btn" href="QR_Code.html">QR Code</a>
        <a class="btn" href="index_4.html">UI DOM</a>
        <a class="btn" href="bonus.html">Jeu Bonus</a>
    </nav>

    <script>
        (function() {
            const here = location.pathname.split('/').pop().toLowerCase();
            document.querySelectorAll('nav.overlay a').forEach(a => {
                const href = a.getAttribute('href').split('/').pop().toLowerCase();
                if (href === here) a.setAttribute('aria-current', 'page');
            });
        })();
    </script>




    <a-scene embedded arjs="sourceType: webcam; debugUIEnabled: false;">
        <a-marker preset="hiro">
            <a-box class="clickable" material="color: blue; opacity: 0.5; transparent: true" position="0 1 0" spin="speed: 180" speed-on-click="normal:2000; fast:400" color-random-hex-on-click></a-box>
        </a-marker>

        <!-- Curseur souris/touch dédié -->
        <a-entity cursor="rayOrigin: mouse; fuse: false" raycaster="objects: .clickable; interval: 0; far: 50"></a-entity>

        <!-- Caméra AR.js (ne rien mettre d’autre dessus) -->
        <a-entity camera></a-entity>
    </a-scene>
</body>

</html>